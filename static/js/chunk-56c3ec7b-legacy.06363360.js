(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56c3ec7b"],{"45eb":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"root",staticClass:"layout"},[s("div",{staticClass:"toggle",class:{active:t.sidebar},on:{click:t.toggleSidebarStatus}},[s("icon",{attrs:{icon:["fas","sliders-h"]}})],1),s("header",{style:t.options.noPadding?"padding: 0.5rem 0;":""},[s("span",{staticClass:"title"},[t._v(t._s(t.options.title?t.options.title:t.$route.meta.title))]),t.$slots.header?s("div",{staticClass:"btn-container"},[t._t("header")],2):t._e()]),s("main",{on:{click:function(e){return t.setSidebarStatus(!1)}}},[t._t("default"),s("div",{staticClass:"end-center"},[t._t("end")],2)],2),s("footer",[s("div",{staticClass:"float-btns"},[t._t("footer")],2)])])},a=[],r=s("2f62"),n={computed:{...Object(r["c"])(["sidebar"])},methods:{...Object(r["b"])("app",["toggleSidebarStatus","setSidebarStatus"])},props:{options:{type:Object,default(){return{}}}},provide(){return{toTop:()=>{this.$refs.root.scrollTo({left:0,top:0,behavior:"smooth"})}}}},o=n,l=(s("5985"),s("2877")),c=Object(l["a"])(o,i,a,!1,null,"d1e13472",null);e["a"]=c.exports},5985:function(t,e,s){"use strict";var i=s("72ce"),a=s.n(i);a.a},6552:function(t,e,s){"use strict";var i=s("cb17"),a=s.n(i);a.a},7118:function(t,e,s){"use strict";var i=s("8b3a"),a=s.n(i);a.a},"72ce":function(t,e,s){},"8b3a":function(t,e,s){},cb17:function(t,e,s){},d114:function(t,e,s){"use strict";var i=s("ee15"),a=s.n(i);a.a},d7b7:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("PageLayout",{attrs:{options:t.options},scopedSlots:t._u([{key:"header",fn:function(){return[s("Button",{attrs:{icon:["fab","telegram-plane"],name:t.$route.query.id?"更新":"发布"},nativeOn:{click:function(e){return t.handleSubmit(e)}}})]},proxy:!0},{key:"footer",fn:function(){return[s("button",{on:{click:t.handleDrawerOpen}},[s("icon",{attrs:{icon:["fas","sliders-h"]}})],1)]},proxy:!0}])},[s("Writer",{ref:"writer",attrs:{name:t.inputLabel,title:t.model.title,text:t.model.text,id:t.id||"post"},on:{change:t.onChange}},[s("div",{staticClass:"url"},[s("label",{staticClass:"prefix"},[t._v(t._s(t.baseUrl+"/"+t.category.slug+"/"))]),s("UInput",{attrs:{value:t.slug},on:{change:function(e){return t.slug=e}}})],1)]),s("el-drawer",{staticClass:"drawer",attrs:{title:"文章设定",direction:"rtl",visible:t.drawerOpen},on:{"update:visible":function(e){t.drawerOpen=e}}},[s("el-form",{attrs:{model:t.model,"label-width":"80px","label-position":"top"}},[s("el-form-item",{attrs:{label:"分类"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.categoryId,callback:function(e){t.categoryId=e},expression:"categoryId"}},t._l(t.categoryRecord,(function(t,e){return s("el-option",{key:e,attrs:{label:t.name,value:t._id}})})),1)],1),s("el-form-item",{attrs:{label:"标签"}},[t._l(t.tags,(function(e){return s("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(s){return t.handleClose(e)}}},[t._v(" "+t._s(e)+" ")])})),t.inputVisible?s("el-autocomplete",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small","fetch-suggestions":t.querySearch},on:{select:t.handleSelect},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.newTagValue,callback:function(e){t.newTagValue=e},expression:"newTagValue"}}):s("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 新标签")])],2),s("el-form-item",{attrs:{label:"概要"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入概要(Option)"},model:{value:t.summary,callback:function(e){t.summary=e},expression:"summary"}})],1)],1),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"隐藏?"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.hide,callback:function(e){t.hide=e},expression:"hide"}})],1),s("el-form-item",{attrs:{label:"Copyright?"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.copyright,callback:function(e){t.copyright=e},expression:"copyright"}})],1)],1)],1)],1)},a=[],r=(s("ddb0"),s("9ab4")),n=s("2fe1"),o=s("60a3"),l=s("71ac"),c=s("45eb"),u=s("13cf"),h=s("8eab"),d=s("4bb5");let p=class extends(Object(o["b"])(u["a"])){constructor(){super(...arguments),this.options={title:""},this.inputLabel="想想取个什么题目比较好呢~",this.model={title:"",text:""},this.drawerOpen=!1,this.categoryId="",this.categoryRecord={},this.timer=null,this.allExistTags=[],this.inputVisible=!1,this.newTagValue="",this.slug="",this.summary="",this.hide=!1,this.copyright=!0,this.prefix="mx-space-post",this.tags=[]}async handleDrawerOpen(){this.drawerOpen=!this.drawerOpen;const{data:t}=await this.$api("Category").get(void 0,{params:{type:"Tag"}});this.allExistTags=t.map(t=>({value:t.name}))}async handleSelect(){this.handleInputConfirm()}async handleSubmit(){const t={...this.model,slug:this.slug,categoryId:this.category._id,summary:""===this.summary?void 0:this.summary,hide:this.hide,copyright:this.copyright,tags:this.tags||[]};this.id?await this.$api("Post").update(this.id,t):await this.$api("Post").post(t),this.AfterSubmit(),this.$router.push("/posts")}onChange(t){this.model={...t}}get baseUrl(){return"https://innei.ren"}get category(){const t=this.categories.get(this.categoryId)||{slug:"",name:""};return{_id:this.categoryId,slug:t.slug,name:t.name}}setDefaultCategory(){var t;const e=[...this.categories.entries()];if(this.categoryRecord=Object.fromEntries(e),this.categoryId)return!0;const s=null===(t=e.shift())||void 0===t?void 0:t[1];return!!s&&(this.categoryId=s._id,!0)}mounted(){this.categoryId||(this.timer=setInterval(()=>{const t=this.setDefaultCategory();t&&(clearInterval(this.timer),this.timer=null)},100))}beforeDestroy(){clearInterval(this.timer),this.timer=null}async created(){if(this.options.title=this.id?"修改文章":"撰写新文章",this.id){var t;const{data:e}=await this.$api("Post").get(this.$route.query.id);this.slug=e.slug,this.summary=null!==(t=e.summary)&&void 0!==t?t:"",this.model={title:e.title,text:e.text},this.hide=e.hide,this.categoryId=e.categoryId,this.tags=e.tags||[]}}showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.saveTagInput.$refs.input.focus()})}async querySearch(t,e){const s=this.allExistTags,i=t?s.filter(this.createFilter(t)):s;e(i)}createFilter(t){return e=>0===e.value.toLowerCase().indexOf(t.toLowerCase())}handleClose(t){this.tags.splice(this.tags.indexOf(t),1)}handleInputConfirm(){const t=this.newTagValue;t&&!this.tags.includes(t)&&this.tags.push(t),this.inputVisible=!1,this.newTagValue=""}};Object(r["__decorate"])([d["b"]],p.prototype,"categories",void 0),p=Object(r["__decorate"])([Object(n["b"])({components:{Button:l["a"],PageLayout:c["a"],Writer:u["b"],UInput:h["a"]}})],p);var g=p,m=g,f=(s("7118"),s("d114"),s("6552"),s("2877")),b=Object(f["a"])(m,i,a,!1,null,"18987e07",null);e["default"]=b.exports},ee15:function(t,e,s){}}]);